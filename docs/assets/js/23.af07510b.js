(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{608:function(s,n,a){"use strict";a.r(n);var e=a(15),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"},[s._v("介绍")]),a("p",[a("a",{attrs:{href:"https://www.rollupjs.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("rollup.js"),a("OutboundLink")],1),s._v("是Javascript的ES模块打包器。与Webpack偏向于应用打包的定位不同，rollup.js更专注于Javascript类库打包（虽然rollup.js也可以提供资源打包，但显然这不是它的强项）。")])]),a("h2",{attrs:{id:"工作原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#工作原理"}},[s._v("#")]),s._v(" 工作原理")]),s._v(" "),a("p",[s._v("rollup.js 可以将我们编写的Javascript代码（通过插件可以支持更多语言，比如Typescript）与第三方模块打包在一起，形成一个文件，该文件可以是一个库（Library）或者一个应用（APP），在打包过程中可以应用各类插件实现特定功能。\n"),a("img",{attrs:{src:"https://raw.githubusercontent.com/LinnerOhara/blog/main/img/202210181951.jpg",alt:"渲染层和逻辑层"}}),s._v("\nrollup.js默认采用ES模块标准，我们可以通过rollup-plugin-commonjs插件使之支持CommonJs标准。")]),s._v(" "),a("h2",{attrs:{id:"rollup-js打包实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rollup-js打包实例"}},[s._v("#")]),s._v(" rollup.js打包实例")]),s._v(" "),a("p",[s._v("通过"),a("code",[s._v("rollup")]),s._v("指令，我们可以快速预览打包后的源码，和babel类似：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ rollup src/main.js -f es\n\nsrc/main.js  stdout...\n// some javascript code\ncreated stdout in 26ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("需要注意"),a("code",[s._v("rollup")]),s._v("必须带有"),a("code",[s._v("-f")]),s._v("参数，否则会报错：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ rollup src/main.js\n\nsrc/main.js  stdout...\n[!] Error: You must specify output.format, which can be one of 'amd', 'cjs', 'system', 'esm', 'life' or 'umd'\nhttps://rollupjs.org/guide/en#output-format-f-format\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("通过上面的错误提示，我们了解到"),a("code",[s._v("-f")]),s._v("的值可以为 'amd'、'cjs'、'system'、'esm(es也可以)'、'life'或'umd'中的任何一个。"),a("code",[s._v("-f")]),s._v("参数是"),a("code",[s._v("--format")]),s._v("的缩写，它表示生成代码的格式，amd表示采用AMD标准，cjs为CommonJs标准，esm（或es）为ES模块标准。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ rollup src/main.js -f es -o dist/bundle.js\n\nsrc/main.js  dist/bundle.js...\ncreated dist/bundle.js in 29ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("参数"),a("code",[s._v("-o")]),s._v("指定了输出的路径，这里我们将打包后的文件输出到dist目录下的bundle.js，这个文件内容与我们之前预览的内容是完全一致的。我们再输出一份CommonJS格式的代码：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ rollup src/main.js --format cjs --output.file dist/bundle-cjs.js\n\nsrc/main.js  dist/bundle-cjs.js...\ncreated dist/bundle-cjs.js in 27ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("参数"),a("code",[s._v("--output.file")]),s._v("是"),a("code",[s._v("-o")]),s._v("的全称，他们是等价的。")]),s._v(" "),a("h3",{attrs:{id:"rollup-js配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rollup-js配置文件"}},[s._v("#")]),s._v(" rollup.js配置文件")]),s._v(" "),a("p",[s._v("实际使用中我们并不会像上文一样通过命令行操作，因为功能单一，且无法使用插件，所以我们需要借助配置文件来操作。")]),s._v(" "),a("p",[s._v("首先在代码根目录下创建rollup.config.js文件，写入以下配置：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("export default {\n  input: './src/main.js',\n  output: [{\n    file: './dist/index-cjs.js',\n    format: 'cjs',\n    banner: \"// welcome to Lanier's Blog',\n    footer: '// powered by Lanier'\n  }, {\n    file: './dist/index-es.js',\n    format: 'es',\n    banner: \"// welcome to Lanier's Blog\",\n    footer: '// powered by Lanier'\n  }]\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("rollup的配置文件非常容易理解：")]),s._v(" "),a("ul",[a("li",[s._v("rollup的配置文件需要采用ES模块标准编写")]),s._v(" "),a("li",[s._v("input表示入口文件的路径（老版本为entry，已经废弃）")]),s._v(" "),a("li",[s._v("output表示输出文件的内容它允许传入一个对象或一个数组，当为数组时，依次输出多个文件，它包含以下内容：\n"),a("ul",[a("li",[s._v("output file：输出文件的路径（老版本为dest，已经废弃）")]),s._v(" "),a("li",[s._v("output format：输出文件的格式")]),s._v(" "),a("li",[s._v("output banner：文件头部添加的内容")]),s._v(" "),a("li",[s._v("output footer：文件末尾添加的内容\n通过"),a("code",[s._v("rollup -c")]),s._v("指令打包，rollup.js会自动寻找名称为rollup.config.js的配置文件")])])])]),s._v(" "),a("h3",{attrs:{id:"rollup-js-api打包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rollup-js-api打包"}},[s._v("#")]),s._v(" rollup.js api打包")]),s._v(" "),a("p",[s._v("很多时候命令行和配置文件的打包方式无法满足需求，我们需要更加个性化的打包方式，这时我们可以考虑通过rollup.js的api进行打包，创建rollup-input-options.js,这是输入配置，我们单独封装一个模块，提高复用性和可扩展性。")]),s._v(" "),a("p",[s._v("在输入配置文件中加入以下内容，需要注意的是这个文件必须是CommonJS格式，因为需要使用nodejs来执行：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("module.export = {\n  input: './src/main.js'\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("再添加一个输出配置文件，在输出配置文件中我们依旧使用一个数组，实现多种文件格式的输出，需要注意的是umd格式必须指定模块名称，通过name属性来实现：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("module.exports = [{\n  file: './dist/index-cjs.js',\n  format: 'cjs',\n  banner: \"// welcome to Lanier's Blog\",\n  footer: '// powered by Lanier'\n}, {\n  file: './dist/index-es.js',\n  format: 'es',\n  banner: \"// welcome to Lanier's Blog\",\n  footer: '// powered by Lanier',\n}, {\n  file: './dist/index-amd.js',\n  format: 'amd',\n  banner: \"// welcome to Lanier's Blog\",\n  footer: '// powered by Lanier',\n}, {\n  file: './dist/index-umd.js',\n  format: 'umd',\n  name: 'sam-umd', // 指定文件名称\n  banner: \"// welcome to Lanier's Blog\",\n  footer: '// powered by Lanier',\n}]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[s._v("接下来我们要在当前项目中安装rollup库：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm i -D rollup\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("创建一个rollup-build文件，通过这个文件来调用rollup的api,rollup-build的源码如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const rollup = require('rollup')\nconst inputOptions = require('./rollup-input-options')\nconst outputOptions = require('./rollup-output-options')\n\nasync function rollupBuild(input, output) {\n  const bundle = await rollup.rollup(input)   // 根据input配置打包\n  console.log(`正在生成：${output.file}`)\n  await bundle.write(output)  //  根据output配置输出文件\n  console.log(`${output.file}生成成功！`)\n}\n\n(async function() {\n  for (let i = 0; i < outputOptions.length; i++) {\n    await rollupBuild(inputOptions, outputOptions[i])\n  }\n})()\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h2",{attrs:{id:"常用插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用插件"}},[s._v("#")]),s._v(" 常用插件")])])}),[],!1,null,null,null);n.default=t.exports}}]);