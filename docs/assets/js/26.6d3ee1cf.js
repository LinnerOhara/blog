(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{578:function(v,o,_){"use strict";_.r(o);var e=_(13),t=Object(e.a)({},(function(){var v=this,o=v.$createElement,_=v._self._c||o;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("div",{staticClass:"custom-block tip"},[_("p",{staticClass:"title"},[v._v("介绍")]),_("ol",[_("li",[v._v("​网页开发渲染线程和脚本线程是互斥的，这也是为什么长时间的脚本运行可能会导致页面失去响应，而在"),_("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/quickstart/#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B8%8E%E6%99%AE%E9%80%9A%E7%BD%91%E9%A1%B5%E5%BC%80%E5%8F%91%E7%9A%84%E5%8C%BA%E5%88%AB",target:"_blank",rel:"noopener noreferrer"}},[v._v("小程序"),_("OutboundLink")],1),v._v("中，二者是分开的，分别运行在不同的线程中。"),_("br")]),v._v(" "),_("li",[v._v("小程序的逻辑层和渲染层是分开的，逻辑层运行在 JSCore 中，并没有一个完整浏览器对象，因而缺少相关的DOM API和BOM API。同时 JSCore 的环境同 NodeJS 环境也是不尽相同，所以一些 NPM 的包在小程序中也是无法运行的。"),_("br")]),v._v(" "),_("li",[v._v("小程序开发过程中需要面对的是两大操作系统 iOS 和 Android 的微信客户端，以及用于辅助开发的小程序开发者工具。")])])]),_("p",[_("strong",[v._v("小程序的运行环境")])]),v._v(" "),_("table",[_("thead",[_("tr",[_("th",[v._v("运行环境")]),v._v(" "),_("th",[v._v("逻辑层")]),v._v(" "),_("th",[v._v("渲染层")])])]),v._v(" "),_("tbody",[_("tr",[_("td",[v._v("ios")]),v._v(" "),_("td",[v._v("javaScriptCore")]),v._v(" "),_("td",[v._v("WKWebView")])]),v._v(" "),_("tr",[_("td",[v._v("安卓")]),v._v(" "),_("td",[v._v("V8")]),v._v(" "),_("td",[v._v("chromium定制内核")])]),v._v(" "),_("tr",[_("td",[v._v("小程序开发工具")]),v._v(" "),_("td",[v._v("NWJS")]),v._v(" "),_("td",[v._v("Chrome WebView")])])])]),v._v(" "),_("p",[_("strong",[v._v("渲染层和逻辑层")]),v._v("\n小程序的渲染层和逻辑层分别由2个线程管理：渲染层的界面使用了WebView 进行渲染；逻辑层采用JsCore线程运行JS脚本，整个小程序"),_("code",[v._v("只有一个APP实例")]),v._v("，切换小程序页面时，小程序逻辑层的JS脚本运行上下文依旧在"),_("code",[v._v("同一个JsCore线程")]),v._v("中。一个小程序存在多个界面，所以"),_("code",[v._v("渲染层存在多个WebView线程")]),v._v("，这两个线程的通信会经由微信客户端（下文中也会采用Native来代指微信客户端）做中转，逻辑层发送网络请求也经由Native转发，小程序的通信模型下图所示。")]),v._v(" "),_("p",[v._v("与此同时，我们要特别留意一点，所有页面的脚本逻辑都跑在同一个JsCore线程，页面使用setTimeout或者setInterval的定时器，然后跳转到其他页面时，这些定时器并没有被清除，需要开发者自己在页面离开的时候进行"),_("code",[v._v("清理")]),v._v("。")]),v._v(" "),_("p",[_("img",{attrs:{src:"https://raw.githubusercontent.com/LinnerOhara/blog/main/img/4-1.ad156d1c.png",alt:"渲染层和逻辑层"}})]),v._v(" "),_("p",[_("strong",[v._v("程序的生命周期")]),v._v("\n初次进入小程序的时候，微信客户端初始化好宿主环境，同时从网络下载或本地缓存中拿到小程序的代码包，把它注入到宿主环境,初始化完成后，微信客户端就会给"),_("code",[v._v("App实例")]),v._v("派发"),_("code",[v._v("onLaunch")]),v._v("事件，App构造器参数所定义的onLaunch方法会被调用。")]),v._v(" "),_("p",[v._v("进入小程序之后，用户可以点击右上角的关闭，或者按手机设备的Home键离开小程序，此时小程序并没有被直接销毁，我们把这种情况称为"),_("code",[v._v("“小程序进入后台状态”")]),v._v("，App构造器参数所定义的"),_("code",[v._v("onHide")]),v._v("方法会被调用。")]),v._v(" "),_("p",[v._v("当再次回到微信或者再次打开小程序时，微信客户端会把“后台”的小程序唤醒，我们把这种情况称为"),_("code",[v._v("“小程序进入前台状态”")]),v._v("，App构造器参数所定义的"),_("code",[v._v("onShow")]),v._v("方法会被调用。")]),v._v(" "),_("p",[_("code",[v._v("onLoad早于 onShow。")])]),v._v(" "),_("p",[_("strong",[v._v("页面的生命周期")])]),v._v(" "),_("p",[v._v("页面初次加载的时候，微信客户端就会给Page实例派发onLoad事件，Page构造器参数所定义的onLoad方法会被调用，"),_("code",[v._v("onLoad在页面没被销毁之前只会触发1次")]),v._v("，在onLoad的回调中，可以获取当前页面所调用的打开参数option")]),v._v(" "),_("p",[v._v("页面显示之后，Page构造器参数所定义的"),_("code",[v._v("onShow")]),v._v("方法会被调用，一般从别的页面返回到当前页面时，当前页的onShow方法都会被调用。")]),v._v(" "),_("p",[v._v("在页面初次渲染完成时，Page构造器参数所定义的onReady方法会被调用，"),_("code",[v._v("onReady在页面没被销毁前只会触发1次")]),v._v("，onReady触发时，表示页面已经准备妥当，在逻辑层就可以和视图层进行交互了。")]),v._v(" "),_("p",[_("code",[v._v("以上三个事件触发的时机是onLoad早于 onShow，onShow早于onReady。")])]),v._v(" "),_("p",[v._v("页面不可见时，Page构造器参数所定义的onHide方法会被调用，这种情况会在使用"),_("code",[v._v("wx.navigateTo")]),v._v("切换到其他页面、"),_("code",[v._v("底部tab切换")]),v._v("时触发。")]),v._v(" "),_("p",[v._v("当前页面使用"),_("code",[v._v("wx.redirectTo")]),v._v("或"),_("code",[v._v("wx.navigateBack")]),v._v("返回到其他页时，当前页面会被微信客户端"),_("code",[v._v("销毁回收")]),v._v("，此时Page构造器参数所定义的"),_("code",[v._v("onUnload")]),v._v("方法会被调用。")]),v._v(" "),_("p",[v._v("小程序的APP.onLaunch 并不会阻塞整个小程序的渲染，所以无法在页面的Page.onLoad获取到 APP.onLaunch 的异步结果")])])}),[],!1,null,null,null);o.default=t.exports}}]);