---
title: 进程、线程和协程
date: 2022-4-8 18:05
tags:
 - 计算机术语
categories: 
 - 计算机术语
---

**线程和进程**

首先我们来回顾下线程和进程的概念：
* 进程(process)：操作系统为正在运行的程序提供的抽象。换句话说，一个进程只是一个正在运行的程序
* 线程(thread)：是操作系统能够进行运算调度的最小单位
 
**线程和进程的区别**
* 线程在进程下运行
* 一个进程可以包含多个线程
* 不同进程之间数据难以共享
* 一个进程的内存空间是共享的,所以同一进程下的线程数据可以共享
* 进程要比线程消耗更多的计算机资源
* 进程间不会相互影响，一个线程挂掉之后将导致整个进程挂掉
* 进程可以扩展到多机，线程最多适合多核
* 进程使用的内存地址可以上锁，即一个线程使用某些共享内存时，其他线程必须等它结束，才能使用这一块内存 —— 互斥锁
* 进程使用的内存地址可以限定使用量 —— 信号量
* 多线程之间会共享同一块地址空间和所有可用数据的能力，这是进程所不具备的
* 线程要比进程更轻量级，由于线程更轻，所以它比进程更容易创建，也更容易撤销。在许多系统中，创建一个线程要比创建一个进程快 10 - 100 倍。
* 如果多个线程都是 CPU 密集型的，那么并不能获得性能上的增强，但是如果存在着大量的计算和大量的 I/O 处理，拥有多个线程能在这些活动中彼此重叠进行，从而会加快应用程序的执行速度

在同一个进程中，允许彼此之间有较大的独立性且互不干扰。在一个进程中并行运行多个线程类似于在一台计算机上运行多个进程。在多个线程中，各个线程共享同一地址空间和其他资源。在多个进程中，进程共享物理内存、磁盘、打印机和其他资源。因为线程会包含有一些进程的属性，所以线程被称为`轻量的进程(lightweight processes)`。`多线程(multithreading)`一词还用于描述在同一进程中多个线程的情况。

线程不像是进程那样具备较强的独立性。同一个进程中的所有线程都会有完全一样的地址空间，这意味着它们也共享同样的全局变量。由于每个线程都可以访问进程地址空间内每个内存地址，因此一个线程可以读取、写入甚至擦除另一个线程的堆栈。

**协程**

协程，是一种比线程更加轻量级的存在。

协程不是进程，也不是线程，它就是一个可以在某个地方挂起的特殊函数，并且可以重新在挂起处继续运行。一个线程也可以包含多个协程，一个线程内的多个协程的运行是串行的。如果有多核CPU的话，多个进程或一个进程内的多个线程是可以并行运行的，但是一个线程内的多个协程却绝对串行的，无论有多少个CPU（核）。

一个线程内的多个协程是串行执行的，不能利用多核，所以，显然，协程不适合计算密集型的场景。协程适合I/O 阻塞型。

在有大量IO操作业务的情况下，我们采用协程替换线程，可以到达很好的效果，一是降低了系统内存，二是减少了系统切换开销，因此系统的性能也会提升。

在协程中尽量不要调用阻塞IO的方法，比如打印，读取文件，Socket接口等，除非改为异步调用的方式，并且协程只有在IO密集型的任务中才会发挥作用。

协程只有和异步IO结合起来才能发挥出最大的威力。